---
title: "Road Traffic Accidents Data Analysis using R"
author: 'Student ID: 201081646'
header-includes: \usepackage{float} \floatplacement{figure}{H}
output:
  pdf_document:
    fig_caption: yes
    fig_crop: yes
    fig_height: 3.3
    fig_width: 5.3
    keep_tex: yes
    number_sections: yes
    toc_depth: 2
  html_document:
    fig_caption: yes
    theme: journal
    toc: yes
    toc_depth: 2
  github_document:
    toc_depth: 2
  word_document:
    toc: yes
    toc_depth: '2'
bibliography: Stats.bib
---

```{r, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
```

# Introduction

This report is the second assessment of the **MATH5741M Statistical Theory and Methods** module. Its aim is to answer statistically three questions regarding a road traffic accidents dataset collected by the UK Department for Transport in 2005.

All the analysis has been done using **R** (programming language) and is code reproducible. To see the complete coding process for data preparation and analysis visit https://github.com/eugenividal/Road-Traffic-Accidents-Data-Analysis

```{r, message=FALSE, warning=FALSE, include=FALSE}
# Activate libraries
library(tidyverse)
library(cowplot)
```

```{r eval=TRUE, include=FALSE}
# Read csv in R
xx=read.csv("DfTaccidents.csv", header=T)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
# Have a look at the variables we got
names(xx)
# Drop all those we do not need
xx <- xx[, c(8, 11, 30)]
# We check for NA's, Class and other characteristics of the data
summary(xx)
```

```{r, include=FALSE}
# Rename labels of Urban_or_Rural_Area
xx$Urban_or_Rural_Area[xx$Urban_or_Rural_Area == "1"] <- "Urban"
xx$Urban_or_Rural_Area[xx$Urban_or_Rural_Area == "2"] <- "Rural"
xx$Urban_or_Rural_Area[xx$Urban_or_Rural_Area == "3"] <- "Unallocated"

# Rename labels of day of the week
xx$Day_of_Week[xx$Day_of_Week == "1"] <- "Sunday"
xx$Day_of_Week[xx$Day_of_Week == "2"] <- "Monday"
xx$Day_of_Week[xx$Day_of_Week == "3"] <- "Tuesday"
xx$Day_of_Week[xx$Day_of_Week == "4"] <- "Wednesday"
xx$Day_of_Week[xx$Day_of_Week == "5"] <- "Thursday"
xx$Day_of_Week[xx$Day_of_Week == "6"] <- "Friday"
xx$Day_of_Week[xx$Day_of_Week == "7"] <- "Saturday"

#xx$Day_of_Week  <- factor(xx$Day_of_Week , levels= c("Sunday", "Monday", 
#    "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
# Show first 6 rows
head(xx)
```

# Results

## Question 1

<!--(1)Draw a boxplot to compare the number of vehicles involved in an urban area, with the number involved in a rural area. (2) Explain why a transformation of the data may (or may not) be appropriate. Using your transformation (or not) (3) carry out a suitable test to investigate whether the average number of vehicles in an accident differs in urban and rural areas.-->

In this question, first, we are asked to draw a boxplot to compare the number of vehicles involved in urban areas with the number invlolved in rural areas.

To plot the boxplot, we first remove the unallocated values, and then we transform the data due to the fact that it is not symetric. It is very skewed to the left (see histogram 1). The transofrmation that we use is log10.

```{r, fig.align='center', message=FALSE, warning=FALSE, include=FALSE, out.extra=''}
# Remove Unallocated recods
xx_area = xx[!xx$Urban_or_Rural_Area == "Unallocated",]
```

```{r, fig.align='center', message=FALSE, warning=FALSE, include=FALSE, out.extra=''}
# Draw a boxplot
p <- ggplot(xx_area, aes(x=Urban_or_Rural_Area, y=Number_of_Vehicles))+geom_boxplot()
p + ggtitle("Figure 1. Number of vehicles involved grouped by type of area") +
  xlab("Type of area") + ylab("Number of vehicles")
```

```{r, fig.align='center', message=FALSE, warning=FALSE, include=FALSE, out.extra=''}
# Summaries
summary(xx_area$Number_of_Vehicles)
summary(log2(xx_area$Number_of_Vehicles))
summary(log10(xx_area$Number_of_Vehicles))
summary(sqrt(xx_area$Number_of_Vehicles))

# Histograms
p2 <- ggplot(xx_area, aes(x=Number_of_Vehicles)) +
    geom_histogram(position="identity", colour="grey40", alpha=0.2, bins = 10) +
    facet_grid(. ~ Urban_or_Rural_Area)
p4<-p2 + scale_y_continuous(trans = "log2")
p3<-p2 + scale_y_continuous(trans = "log10")
p5<-p2 + scale_y_continuous(trans = "sqrt")
cowplot::plot_grid(p2, p3, p4, p5, labels = c("","log2","log10","sqrt"), align = "h")
```

```{r, fig, fig.cap="Number of vehicles involved grouped by type of area", echo=FALSE, message=FALSE, warning=FALSE, out.extra='',fig.align='center'}
# Boxplot with data transformed
p6 <- ggplot(xx_area, aes(x=Urban_or_Rural_Area, y=Number_of_Vehicles))+geom_boxplot()+scale_y_log10()
p6 +  xlab("Type of area") + ylab("Number of vehicles -log10") +  theme_minimal(base_size = 8)
```

Secondly, we have to carry out a test to investigate wheter the average number of vehicles in an accident differs per type of area.

For this, using the transformation we perform a pooled variance test  (https://statistics.laerd.com/statistical-guides/independent-t-test-statistical-guide.php)

$$H_{0}: \mu_{urban} = \mu_{rural}\;\;\;vs.\;\;\;H_{1}: \mu_{urban} \neq \mu_{rural}$$
```{r, message=FALSE, warning=FALSE, include=FALSE}
# Check the variance of the two groups
xx_area$log10 <- log10(xx_area$Number_of_Vehicles)
Urban_or_Rural_Area <- xx_area$Urban_or_Rural_Area
var(xx_area[Urban_or_Rural_Area=="Urban",4])        # apply the var function 
var(xx_area[Urban_or_Rural_Area=="Rural",4])
```

They are not about the same, should we continue with a two sample test which assumes equal variance? The independent t-test assumes the variances of the two groups you are measuring are equal in the population. If your variances are unequal, this can affect the Type I error rate. The assumption of homogeneity of variance can be tested using Levene's Test of Equality of Variances.

```{r}
# pooled variance test
#t.test(xx[])
```

In conclusion, we can say that

## Question 2

<!--Using a suitable statistical hypothesis test, investigate whether the frequency of accidents varies by day of the week. Repeat this test using only week-days (excuding Saturday and Sunday).-->

In this question, first, we have to investigate whether the frequency of accidents varies by day of the week using the suitable statistical hypothesis test.

For this, we apply a Chi-squared test.

```{r}
# hypothesis per each day
ggplot(xx, aes(x=Day_of_Week))+geom_bar() +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
```

Next, we are required to do the same test using only week-days (excluding Saturday and Sunday).

```{r}
# Select data using only week-days
week_days <- xx%>%
  select(Day_of_Week)%>%
  filter(!Day_of_Week %in% c("Saturday", "Sunday"))
table(week_days)

ggplot(week_days, aes(x=Day_of_Week))+geom_bar() +
  theme(axis.text.x = element_text(angle = 45, hjust=1)) 

# hypothesis per each day using only week-days

```

## Question 3

<!--Compute a 95% confidence interval for the expected (mean) number of accidents which occur on a Monday. State your assumptions in computing this interval, and verify whether they are valid.-->

Finally, in question 3, we are asked to compute a 95% confidence interval for the expected (mean) number of accidents which occur on a Monday.

```{r}
# Select data using only week-days
week_days<- xx%>%
  select(Day_of_Week)%>%
  filter(Day_of_Week == "Monday")
```

# Bibliography

The resources used to carry out this project were:

- Balka, J. 2013. JBStatistics: Making Statistics Make Sense. Available from: http://www.jbstatistics.com.
- Lane, D.M. 2018. Online Statistics Education: An Interactive Multimedia Course of Study. Available from: http://onlinestatbook.com/.
- Taylor, C. 2017. MATH5741M: Statistical Theory and Methods. Outline Lecture Notes.
- Yau, C. 2018. R tutorial: an R introduction to statistics. Available from: http://www.r-tutor.com